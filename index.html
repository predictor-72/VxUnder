<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lottery Predictor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e2f;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 50px;
    }
    h1 {
      color: #4CAF50;
    }
    button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 15px 25px;
      text-align: center;
      font-size: 16px;
      margin: 20px;
      border-radius: 10px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .result {
      font-size: 18px;
      margin-top: 20px;
      background: #2e2e40;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¯ Lottery Predictor</h1>
  <button onclick="predictResult()">Get Prediction</button>
  <div class="result" id="result">Click above to get prediction</div>

  <script>
    const url = "https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json?ts=1751470259428";
    let csvData = [];

    // Load CSV without headers (first column: period, second: bigsmall)
    fetch('data.csv')
      .then(response => response.text())
      .then(csvText => {
        Papa.parse(csvText, {
          header: false,
          skipEmptyLines: true,
          complete: function(results) {
            csvData = results.data.map(row => ({
              period: row[0],
              bigsmall: row[1]
            }));
          }
        });
      });

    function determineColor(number) {
      const colorMap = {
        0: 'Red', 1: 'Green', 2: 'Red', 3: 'Green', 4: 'Red',
        5: 'Green', 6: 'Red', 7: 'Green', 8: 'Red', 9: 'Green'
      };
      return colorMap[number % 10];
    }

    function oppositeColor(color) {
      return color === 'Red' ? 'Green' : 'Red';
    }

    function oppositeSize(size) {
      return size === 'BIG' ? 'SMALL' : 'BIG';
    }

    function getBigSmallFromCSV(period) {
      const row = csvData.find(item => item.period == period);
      return row ? row.bigsmall.toUpperCase() : 'N/A';
    }

    async function predictResult() {
      try {
        const response = await fetch(url);
        const data = await response.json();
        const issues = data.data.list;
        const currentIssue = issues[0].issueNumber;
        const lastNumbers = issues.slice(0, 5).map(item => parseInt(item.number));
        const nextPeriod = parseInt(currentIssue.slice(-3)) + 1;

        let predictedNumber;
        if (lastNumbers[0] === lastNumbers[1]) {
          predictedNumber = lastNumbers[0];
        } else {
          predictedNumber = (lastNumbers[0] + 1) % 10;
        }

        let predictedColor = determineColor(predictedNumber);
        let predictedSize = getBigSmallFromCSV(nextPeriod); // from CSV

        if (predictedSize === 'N/A') {
          predictedSize = 'Not Found in CSV';
        }

        if (nextPeriod >= 125 && nextPeriod <= 130) {
          predictedColor = oppositeColor(predictedColor);
          predictedSize = oppositeSize(predictedSize);
        }

        document.getElementById("result").innerHTML = `
          ğŸ¯ Period Number: ${nextPeriod} <br>
          ğŸ”¢ Predicted Number: ${predictedNumber} <br>
          ğŸ¨ Predicted Color: ${predictedColor} <br>
          ğŸ“Š Prediction (Big/Small): ${predictedSize} <br><br>
          âœ… Thank you for using Team vXunder
        `;
      } catch (error) {
        document.getElementById("result").innerHTML = `âŒ Error: ${error.message}`;
      }
    }
  </script>
</body>
</html>